#!/bin/bash

# Скрипт для ручного запуска импорта транзакций для конкретного пользователя.
#
# Использование:
# ./manual_import.sh [USER_ID] [DAYS]
#
# [USER_ID]: Обязательный. ID пользователя из таблицы 'users' в базе данных.
# [DAYS]:    Обязательный. Количество последних дней, за которые нужно импортировать транзакции.
#
# Примеры:
# ./manual_import.sh 1 7     # Запустить импорт для пользователя с ID=1 за последние 7 дней.
# ./manual_import.sh 12 30    # Запустить импорт для пользователя с ID=12 за последние 30 дней.

# --- НАЧАЛО СКРИПТА ---

# Проверка наличия аргументов
if [ -z "$1" ] || [ -z "$2" ]; then
  echo "Ошибка: Недостаточно аргументов."
  echo "Использование: ./manual_import.sh [USER_ID] [DAYS]"
  exit 1
fi

USER_ID=$1
DAYS=$2

# Проверка, что ID и дни являются числами
if ! [[ "$USER_ID" =~ ^[0-9]+$ ]] || ! [[ "$DAYS" =~ ^[0-9]+$ ]]; then
    echo "Ошибка: USER_ID и DAYS должны быть числами."
    exit 1
fi

echo "Запуск ручного импорта для пользователя ID: ${USER_ID} за последние ${DAYS} дней..."
echo ""

# Запускаем Node.js скрипт с нужными параметрами
node backend/worker/schedule_imports.js manualImport:${DAYS}:${USER_ID}

echo ""
echo "Скрипт импорта завершил работу. Проверьте логи для получения детальной информации."
echo "Путь к логам на сервере: /root/.pm2/logs/" 
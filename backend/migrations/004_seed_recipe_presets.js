exports.shorthands = undefined;

exports.up = async (pgm) => {
    const presets = [
        { name: 'Капучино (250 мл)', items: { 'Кофе': 10, 'Вода': 175, 'Сливки': 34, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Капучино (350 мл)', items: { 'Кофе': 14, 'Вода': 235, 'Сливки': 36, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Латте (250 мл)', items: { 'Кофе': 9, 'Вода': 180, 'Сливки': 37, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Латте (350 мл)', items: { 'Кофе': 12, 'Вода': 245, 'Сливки': 52, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Эспрессо', items: { 'Кофе': 12, 'Вода': 55, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Мокачино (250 мл)', items: { 'Кофе': 9, 'Вода': 180, 'Сливки': 22, 'Какао': 15, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Мокачино (350 мл)', items: { 'Кофе': 12, 'Вода': 250, 'Сливки': 27, 'Какао': 26, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Горячий шоколад (250 мл)', items: { 'Вода': 170, 'Какао': 46, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Горячий шоколад (350 мл)', items: { 'Вода': 230, 'Какао': 63, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Банановый раф (250 мл)', items: { 'Кофе': 10, 'Вода': 190, 'Раф': 19, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Банановый раф (350 мл)', items: { 'Кофе': 12, 'Вода': 265, 'Раф': 28, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Флэт уайт', items: { 'Кофе': 18, 'Вода': 190, 'Сливки': 27, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Американо', items: { 'Кофе': 21, 'Вода': 270, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Шоколадно-банановый раф (250 мл)', items: { 'Кофе': 10, 'Вода': 190, 'Раф': 11, 'Какао': 16, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Шоколадно-банановый раф (350 мл)', items: { 'Кофе': 12, 'Вода': 255, 'Раф': 16, 'Какао': 22, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Какао (250 мл)', items: { 'Вода': 160, 'Сливки': 22, 'Какао': 22, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Какао (350 мл)', items: { 'Вода': 230, 'Сливки': 33, 'Какао': 30, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Сливочно-банановый коктейль', items: { 'Вода': 220, 'Сливки': 27, 'Раф': 16, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Горячая вода', items: { 'Вода': 300, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Капучино дабл', items: { 'Кофе': 18, 'Вода': 278, 'Сливки': 30, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
        { name: 'Шоколадный сливочный коктейль', items: { 'Вода': 225, 'Сливки': 10, 'Раф': 20, 'Какао': 15, 'Стакан': 1, 'Крышка': 1, 'Сахар': 2, 'Размешиватель': 1 } },
    ];

    for (const preset of presets) {
        const result = await pgm.db.query(
            `SELECT id FROM recipe_presets WHERE name = $1 AND user_id IS NULL`,
            [preset.name]
        );

        if (result.rows.length === 0) {
            await pgm.db.query(
                `INSERT INTO recipe_presets (user_id, name, items) VALUES (NULL, $1, $2)`,
                [preset.name, JSON.stringify(preset.items)]
            );
        }
    }
};

exports.down = async (pgm) => {
    const presetNames = [
        'Капучино (250 мл)', 'Капучино (350 мл)', 'Латте (250 мл)', 'Латте (350 мл)',
        'Эспрессо', 'Мокачино (250 мл)', 'Мокачино (350 мл)', 'Горячий шоколад (250 мл)',
        'Горячий шоколад (350 мл)', 'Банановый раф (250 мл)', 'Банановый раф (350 мл)',
        'Флэт уайт', 'Американо', 'Шоколадно-банановый раф (250 мл)',
        'Шоколадно-банановый раф (350 мл)', 'Какао (250 мл)', 'Какао (350 мл)',
        'Сливочно-банановый коктейль', 'Горячая вода', 'Капучино дабл',
        'Шоколадный сливочный коктейль'
    ];
    
    await pgm.db.query(
        `DELETE FROM recipe_presets WHERE user_id IS NULL AND name = ANY($1)`,
        [presetNames]
    );
};
# Telegram Bot System Upgrade Guide

## üéØ –¶–µ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

–ú–æ–¥–µ—Ä–Ω–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã Telegram –±–æ—Ç–∞ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å **100+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** –ø—É—Ç–µ–º —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º rate limiting –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

## ‚ö†Ô∏è –ò—Å—Ö–æ–¥–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º—ã –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:
1. **–û—à–∏–±–∫–∞ 429 "Too Many Requests"** –æ—Ç Telegram API
2. **–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ —Ü–∏–∫–ª—ã –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞** - –±–æ—Ç –ø–∞–¥–∞–ª –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã
3. **–ù–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ API –≤—ã–∑–æ–≤—ã** –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è `bot.js`
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—á–µ—Ä–µ–¥–µ–π** –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
5. **–°–ø–∞–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** –∞–¥–º–∏–Ω–∞–º –ø—Ä–∏ –º–∞—Å—Å–æ–≤—ã—Ö –æ—à–∏–±–∫–∞—Ö

### –õ–æ–≥–∏ –æ—à–∏–±–æ–∫:
```
0|infocoff | body: {
0|infocoff |   ok: false,
0|infocoff |   error_code: 429,
0|infocoff |   description: 'Too Many Requests: retry after 9'
0|infocoff | }
```

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è

### 1. –ó–∞—â–∏—â–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ (`backend/bot.js`)

**–ü–†–û–ë–õ–ï–ú–ê**: IIFE (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è) –≤—ã–∑—ã–≤–∞–ª–∞ API –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–º–ø–æ—Ä—Ç–µ –º–æ–¥—É–ª—è.

**–†–ï–®–ï–ù–ò–ï**:
- ‚úÖ –ü–µ—Ä–µ–Ω–æ—Å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –≤ —Ñ—É–Ω–∫—Ü–∏—é `startPolling()`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É API –≤—ã–∑–æ–≤–∞–º–∏ (5 —Å–µ–∫—É–Ω–¥ + 3 —Å–µ–∫—É–Ω–¥—ã)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π —Å —Ñ–ª–∞–≥–æ–º `isInitialized`
- ‚úÖ Retry –ª–æ–≥–∏–∫–∞ —Å exponential backoff –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö 429
- ‚úÖ –ú–∞–∫—Å–∏–º—É–º 3 –ø–æ–ø—ã—Ç–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

```javascript
// –ë–´–õ–û (–ø—Ä–æ–±–ª–µ–º–Ω–æ–µ):
(async () => {
    const me = await bot.getMe(); // –í—ã–∑–æ–≤ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∏–º–ø–æ—Ä—Ç–µ!
    await bot.setMyCommands([...]); // –ï—â–µ –æ–¥–∏–Ω –≤—ã–∑–æ–≤!
})();

// –°–¢–ê–õ–û (–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ):
const startPolling = async () => {
    if (!isInitialized) {
        await delay(INITIALIZATION_DELAY); // 5 —Å–µ–∫ –∑–∞–¥–µ—Ä–∂–∫–∞
        const me = await bot.getMe();
        await bot.setMyCommands(baseCommands);
        await delay(COMMAND_SETUP_DELAY); // 3 —Å–µ–∫ –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏
        // + –æ–±—Ä–∞–±–æ—Ç–∫–∞ 429 –æ—à–∏–±–æ–∫
    }
};
```

### 2. –°–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π —Å–æ–æ–±—â–µ–Ω–∏–π (`backend/utils/botQueue.js`) 

**–ü–†–û–ë–õ–ï–ú–ê**: –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã `bot.sendMessage()` –±–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª—è rate limiting.

**–†–ï–®–ï–ù–ò–ï**: –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π —Å –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏–µ–π:

**–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:
- üîÑ **3 —Ç–∏–ø–∞ –æ—á–µ—Ä–µ–¥–µ–π**: –æ–±—ã—á–Ω–∞—è, –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è, –Ω–µ—É–¥–∞—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
- ‚ö° **Rate limiting**: 30 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫ (–ª–∏–º–∏—Ç Telegram)
- üîÑ **Auto-retry**: –¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫ —Å exponential backoff
- üìä **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—á–µ—Ä–µ–¥–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- üéØ **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è**: –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏–¥—É—Ç –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**:
```
[–í—Ö–æ–¥—è—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è] 
         ‚Üì
[Priority Queue] ‚Üí [Regular Queue] ‚Üí [Failed Queue]
         ‚Üì              ‚Üì              ‚Üì
    [Rate Limiter] ‚Üí [Telegram API]
         ‚Üì
    [Success/Retry Logic]
```

### 3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–û–±–Ω–æ–≤–ª–µ–Ω—ã —Ñ–∞–π–ª—ã**:
- `backend/utils/botHelpers.js` - –º–∞—Å—Å–æ–≤—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `backend/utils/botNotifier.js` - –ø—Ä–æ—Å—Ç—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `backend/worker/vendista_import_worker.js` - –ø–∞–∫–µ—Ç–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–¥–∞—á

**–£–ª—É—á—à–µ–Ω–∏—è**:
- ‚úÖ **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
- ‚úÖ **Batch –æ—Ç–ø—Ä–∞–≤–∫–∞** - –ø–æ 10 —Å–æ–æ–±—â–µ–Ω–∏–π —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 2 —Å–µ–∫
- ‚úÖ **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è** –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚úÖ **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã**: –∞–¥–º–∏–Ω—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è = –≤—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç

### 4. –£–ª—É—á—à–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–¥–º–∏–Ω—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (`backend/utils/adminErrorNotifier.js`)

**–ü–†–û–ë–õ–ï–ú–ê**: –°–ø–∞–º –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –æ—à–∏–±–æ–∫ –∞–¥–º–∏–Ω–∞–º.

**–†–ï–®–ï–ù–ò–ï**:
- üìä **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –æ—à–∏–±–æ–∫** - –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ö–æ–∂–∏—Ö –∑–∞ 10 —Å–µ–∫—É–Ω–¥
- ‚è∞ **–î–µ–±–∞—É–Ω—Å–∏–Ω–≥** - –Ω–µ –±–æ–ª–µ–µ 1 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ 5 –º–∏–Ω—É—Ç –Ω–∞ –æ—à–∏–±–∫—É
- üìà **–õ–∏–º–∏—Ç** - –º–∞–∫—Å–∏–º—É–º 20 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∞–¥–º–∏–Ω–∞–º –≤ —á–∞—Å
- üéØ **–£–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —Ä–∞–∑–Ω—ã–µ –æ—à–∏–±–∫–∏ –≥—Ä—É–ø–ø–∏—Ä—É—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- üî• **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏** - –æ–±—Ö–æ–¥—è—Ç –ª–∏–º–∏—Ç—ã

### 5. –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ (`backend/utils/botMonitor.js`)

**–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**:
- üíä **Health checks** –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- üìä **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- ‚ö†Ô∏è **–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è** –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ø–æ—Ä–æ–≥–æ–≤
- üî• **–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–ª–µ—Ä—Ç—ã** –ø—Ä–∏ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º–∞—Ö
- üìà **–ò—Å—Ç–æ—Ä–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏**
- üåê **API —ç–Ω–¥–ø–æ–∏–Ω—Ç** `/api/bot-status` –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ú–µ—Ç—Ä–∏–∫–∏**:
```
Queue sizes, processing time, success rate, memory usage,
error rates, rate limiting events, uptime
```

## üìä –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

### Rate Limiting Protection:
- **Global**: 30 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫ (Telegram limit)
- **Per-chat**: –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏
- **429 errors**: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π cooldown —Å retry-after
- **Exponential backoff**: 1s ‚Üí 2s ‚Üí 4s ‚Üí fail

### Queue Capacity:
- **–û–±—ã—á–Ω–∞—è –æ—á–µ—Ä–µ–¥—å**: –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è**: –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **Failed queue**: –¥–æ 3 –ø–æ–ø—ã—Ç–æ–∫ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
- **Batch processing**: 10 —Å–æ–æ–±—â–µ–Ω–∏–π –∑–∞ —Ä–∞–∑

### Error Handling:
- **403 (Bot blocked)**: –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º
- **400 (Bad request)**: –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ–º  
- **429 (Rate limit)**: cooldown + retry
- **–î—Ä—É–≥–∏–µ –æ—à–∏–±–∫–∏**: retry –¥–æ 3 —Ä–∞–∑

### Admin Notifications:
- **–î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è**: 5 –º–∏–Ω—É—Ç –Ω–∞ –æ–¥–Ω—É –æ—à–∏–±–∫—É
- **–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞**: –ø–æ—Ö–æ–∂–∏–µ –æ—à–∏–±–∫–∏ –∑–∞ 10 —Å–µ–∫—É–Ω–¥
- **–õ–∏–º–∏—Ç**: 20 —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π/—á–∞—Å
- **Batch sending**: –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

**–ó–∞–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**:
- `backend/bot.js` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –±–æ—Ç–∞
- `backend/utils/botHelpers.js` - –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `backend/utils/botNotifier.js` - –ø—Ä–æ—Å—Ç—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- `backend/utils/adminErrorNotifier.js` - —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö
- `backend/worker/vendista_import_worker.js` - –∏–º–ø–æ—Ä—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `backend/app.js` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã**:
- `backend/utils/botQueue.js` - —Å–∏—Å—Ç–µ–º–∞ –æ—á–µ—Ä–µ–¥–µ–π
- `backend/utils/botMonitor.js` - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã

### 2. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:

```env
# Production
NODE_ENV=production
TELEGRAM_BOT_TOKEN=your_bot_token
ADMIN_TELEGRAM_BOT_TOKEN=admin_bot_token  
ADMIN_TELEGRAM_CHAT_ID_FOR_ERRORS=admin_chat_id
TELEGRAM_WEB_APP_URL=https://your_app_url

# Development  
NODE_ENV=development
DEV_TELEGRAM_BOT_TOKEN=dev_bot_token
DEV_ADMIN_TELEGRAM_CHAT_ID_FOR_ERRORS=dev_chat_id
DEV_OWNER_TELEGRAM_ID=owner_dev_id
DEV_ADMIN_TELEGRAM_ID=admin_dev_id
DEV_SERVICE_TELEGRAM_ID=service_dev_id
```

### 3. –ó–∞–ø—É—Å–∫ –æ–±–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã

**Development**:
```bash
cd App
npm run dev
```

**Production**:
```bash
cd App
pm2 restart all
pm2 logs infocoffee-bot  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞

**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**:
```
[Bot] Starting safe initialization...
[Bot] Waiting 5000ms before initialization...
[Bot] Got username: @your_bot
[Bot] Basic commands set.
[Bot] All commands configured successfully.
[Bot] Polling started successfully.
[BotMonitor] Starting bot monitoring system...
```

**–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —á–µ—Ä–µ–∑ API**:
```bash
curl http://localhost:3001/api/bot-status
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç**:
```json
{
  "success": true,
  "status": "healthy",
  "performance": {
    "totalMessagesSent": 0,
    "totalMessagesFailed": 0,
    "peakQueueSize": 0
  },
  "currentMetrics": {
    "queue": {
      "regularQueue": 0,
      "priorityQueue": 0,
      "failedMessages": 0,
      "isProcessing": false
    }
  }
}
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

### 1. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫ 429:
```bash
pm2 logs infocoffee-bot --lines 100 | grep -i "429\|rate"
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç—å controlled cooldown —Å–æ–æ–±—â–µ–Ω–∏—è
```

### 2. –°—Ç–∞–±–∏–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤:
```bash
pm2 status
# restart –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å 0 –∏–ª–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º
```

### 3. –ó–¥–æ—Ä–æ–≤—å–µ —Å–∏—Å—Ç–µ–º—ã:
–õ–æ–≥–∏ –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å:
```
[BotMonitor] === SYSTEM STATUS: HEALTHY ===
[BotMonitor] Queues: Regular(0) Priority(0) Failed(0) Processing(false)
```

### 4. –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–ª—è—Ç—å—Å—è:
```
[BotQueue] Added message to queue: task_assignments (queue: 1)
[BotQueue] Sent regular message: task_assignments (telegram_id)
```

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –£—Å—Ç—Ä–∞–Ω–µ–Ω–æ:
- ‚ùå –û—à–∏–±–∫–∏ 429 –æ—Ç Telegram API
- ‚ùå –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏ PM2
- ‚ùå –ù–µ–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ API –≤—ã–∑–æ–≤—ã
- ‚ùå –°–ø–∞–º –∞–¥–º–∏–Ω—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- ‚ùå –ü–æ—Ç–µ—Ä—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ —Å–±–æ—è—Ö

### ‚úÖ –î–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:
- ‚úÖ **–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å**: —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤
- ‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ 100+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å**: –æ—á–µ—Ä–µ–¥–∏ —Å retry –ª–æ–≥–∏–∫–æ–π
- ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –ø–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏—è
- ‚úÖ **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**: –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∏ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è
- ‚úÖ **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å**: graceful degradation

### üìä Performance –º–µ—Ç—Ä–∏–∫–∏:
- **Throughput**: –¥–æ 30 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫—É–Ω–¥—É
- **Latency**: < 1 —Å–µ–∫—É–Ω–¥–∞ –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
- **Success rate**: > 99% (—Å retry –ª–æ–≥–∏–∫–æ–π)
- **Recovery time**: < 30 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ 429 –æ—à–∏–±–æ–∫

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏

### –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
1. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ `/api/bot-status` —Ä–∞–∑ –≤ —á–∞—Å
2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ `status: "critical"`
3. –û—Ç—Å–ª–µ–∂–∏–≤–∞–π—Ç–µ —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–µ–π (> 50 = warning)

### –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ:
1. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–∫–∞—Ö: `pm2 restart infocoffee-bot`
2. –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤: `pm2 flush`
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞–º—è—Ç–∏: –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–π —Ä–æ—Å—Ç –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ –ø—Ä–æ–±–ª–µ–º—ã

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ:
–ü—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (> 200 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):
1. –£–≤–µ–ª–∏—á—å—Ç–µ `NOTIFICATION_BATCH_SIZE` –¥–æ 15-20
2. –î–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ `BATCH_SEND_DELAY_MS`
3. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±–æ—Ç–æ–≤

---

## üèÜ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –±—ã–ª–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–æ–¥–µ—Ä–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–æ–ª—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã, –¥–æ–±–∞–≤–ª–µ–Ω–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥.

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤—É! üöÄ** 